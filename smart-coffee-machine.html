<!doctype html><html lang=en-us><head><meta charset=utf-8><title>thingweb - Smart coffee machine and node-wot API usage</title><meta name=description content><meta name=author content><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet type=text/css media=screen href=./css/bootstrap.css><link rel=stylesheet type=text/css media=screen href=./css/bootstrap-theme.css><link rel=stylesheet type=text/css media=screen href=./css/style.css><link rel=stylesheet type=text/css media=screen href=./css/hover.css><link rel=stylesheet type=text/css media=screen href=./css/hover-min.css><link rel=stylesheet type=text/css media=screen href=./css/owl.carousel.css><link rel=stylesheet type=text/css media=screen href=./css/owl.theme.default.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css><link href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,600,700" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel=stylesheet><link rel="shortcut icon" href=./img/favicon/favicon.png type=image/png><link rel=icon href=./img/favicon/favicon.png type=image/png><meta name=google-site-verification content="086kyR2UJR794fn8Z97o9QMEJLOqCoVhPIqxYtZBSA4"></head><body><header><div class=header-top-all><div class=container><div class=row><div class=col-sm-3><div class=logo><a href=./><img src=./img/logo.png class=img-fluid></a></div></div><div class=col-sm-9><div class=mainmenu><nav class="navbar navbar-expand-md"><button class="navbar-toggler navbar-dark" type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<i class="fa fa-bars"></i></button><div class="collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=./>HOME</a></li><li class=nav-item><a class=nav-link href=./get-involved.html>Get involved</a></li><li class=nav-item><a class=nav-link href=./hands-on.html>Hands-on</a></li><li class=nav-item><a class=nav-link href=./news.html>News</a></li><li class=nav-item><a class=nav-link href=./videos.html>Videos</a></li></ul></div></nav></div></div></div></div></div><div class=header-bottom><div class=container><div class=row><div class=owl-carousel><div class=item><img src=./img/banner/banner-shape-merged.jpg width=100% alt=1><div class=container><div class="carousel-content-panel hidden-xs text-left" style=z-index:0><h1>Thingweb</h1><p>Thingweb node-wot is a runtime and tooling for web technology<br>that enables easy creation of applications for the Internet of Things</p></div></div></div></div></div></div></div></header><div class=holder><div class=wel-holder><div class=container><div><div class=row><div class=col-sm-12><div class=why-text><h1 id=smart-coffee-machine-and-node-wot-api-usage>Smart coffee machine and node-wot API usage</h1><h2 id=introduction>Introduction</h2><p>This article is a tutorial which considers a fictional smart coffee machine in order to demonstrate the capabilities of Web of Things (WoT) and the usage of <a href=https://github.com/eclipse/thingweb.node-wot>node-wot API</a>.
In the world of Web of Thing properties, actions and events provided by a Thing are called Property Affordances, Action Affordances and Event Affordances, respectively.
The difference of each becomes clear as we proceed the tutorial.
So, we imagine a smart coffee machine which provides the following Property Affordances:</p><ul><li><code>allAvailableResources</code> - that is a current level of all available resources (i.e. water, milk, chocolate and coffee beans) given as an integer percentage for each particular resource.
This data is read-only and is obtained from the machine&rsquo;s sensors but can also be set manually via the <code>availableResourceLevel</code> property (next one) in case the sensors are broken.</li><li><code>availableResourceLevel</code> - that is a current level of a particular resource, which should be specified as a query string (called <code>uriVariables</code> in node-wot).
This data is obtained from the previous property (<code>allAvailableResources</code>).
The difference is in usage of <code>uriVariables</code> and that this property is also writable, so that it can be used to override the values of <code>allAvailableResources</code>.</li><li><code>possibleDrinks</code> - a read-only list of possible drinks in general.
Doesn&rsquo;t depend on the available resources.</li><li><code>servedCounter</code> - the total number of served beverages.
This property is writable.
The data is obtained from the machine but can also be set manually (thus, writable).
The case for that is explained below.</li><li><code>maintenanceNeeded</code> - a boolean value showing whether the machine needs a maintenance.
The property is observable, which means in WoT that a user can get notified every time the value of this property changes.
Automatically set to true when the <code>servedCounter</code> property exceeds 1000.</li><li><code>schedules</code> - a read-only array containing scheduled tasks, i.e. a task which should be performed according to a specific schedule.</li></ul><p>The idea behind <code>servedCounter</code> and <code>maintenanceNeeded</code> is that, every time <code>servedCounter</code> exceeds 1000 the <code>maintenanceNeeded</code> flag is set to true.
And since this value is observable a &ldquo;maintainer&rdquo; gets notified, who then comes and performs the maintenance of the machine, and afterwards sets the <code>servedCounter</code> and <code>maintenanceNeeded</code> to 0 and false, respectively.</p><p>The smart coffee machine has also the following Action Affordances:</p><ul><li><code>makeDrink</code> - make a drink from the list of possible beverages.
Accepts drink id, size and quantity as <code>uriVariables</code>.
Brews one medium americano if no <code>uriVariables</code> are specified.</li><li><code>setSchedule</code> - add a scheduled task to the <code>schedules</code> property. Accepts drink id, size, quantity, time and mode as body of a request (i.e. a request payload).
Assumes one medium americano if not specified, but time and mode are mandatory fields.
Notice that, even though the <code>schedules</code> property is read-only, it&rsquo;s being modified through the <code>setSchedule</code> action.
That&rsquo;s the same principle as creating setters for private properties in object-oriented programming languages.</li></ul><p>Finally, the coffee machine has the following Event Affordances:</p><ul><li><code>outOfResource</code> - an out-of-resource event.
Emitted when the available resource level is not sufficient for a desired drink.</li></ul><h2 id=expose-the-thing>Expose the Thing</h2><p>Two main functionalities of node-wot is creating a WoT Thing and interacting with another WoT Thing.
These functionalities can also be combined to have a Thing interacting with other Things.
Creating a WoT Thing is called exposing or producing a Thing.
In order to expose our smart coffee machine we need to invoke <code>produce</code> method of the WoT object.
It takes a Thing Description (TD) as the only parameter.
Note that, this TD can be set only partially.
The full TD will then be produced by the <code>produce</code> method, assuming <a href=https://www.w3.org/TR/wot-thing-description/#sec-default-values>default data</a> for non-specified TD terms and creating default protocol bindings (HTTP and CoAP).
This produced TD can then be used by other Things or clients to interact with the Thing.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>WoT</span>.<span style=color:#a6e22e>produce</span>({
    <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Smart-Coffee-Machine&#39;</span>,
    <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`A smart coffee machine with a range of capabilities.`</span>,
    <span style=color:#a6e22e>support</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;git://github.com/eclipse/thingweb.node-wot.git&#39;</span>,
    <span style=color:#e6db74>&#39;@context&#39;</span><span style=color:#f92672>:</span> [
        <span style=color:#e6db74>&#39;https://www.w3.org/2019/wot/td/v1&#39;</span>,
    ],
    <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>allAvailableResources</span><span style=color:#f92672>:</span> {
            ...
        },
        <span style=color:#a6e22e>availableResourceLevel</span><span style=color:#f92672>:</span> {
            ...
        },
        <span style=color:#a6e22e>possibleDrinks</span><span style=color:#f92672>:</span> {
            ...
        },
        <span style=color:#a6e22e>servedCounter</span><span style=color:#f92672>:</span> {
            ...
        },
        <span style=color:#a6e22e>maintenanceNeeded</span><span style=color:#f92672>:</span> {
            ...
        },
        <span style=color:#a6e22e>schedules</span><span style=color:#f92672>:</span> {
            ...
        }
    },
    <span style=color:#a6e22e>actions</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>makeDrink</span><span style=color:#f92672>:</span> {
            ...
        },
        <span style=color:#a6e22e>setSchedule</span><span style=color:#f92672>:</span> {
            ...
        }
    },
    <span style=color:#a6e22e>events</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>outOfResource</span><span style=color:#f92672>:</span> {
            ...
        }
    }
})
</code></pre></td></tr></table></div></div><p>The full script is available at <a href=https://github.com/eclipse/thingweb.node-wot/blob/master/packages/examples/src/scripts/smart-coffee-machine.ts>node-wot GitHub repository</a>.
Note that, all affordances (i.e. property, action and event) should be added withing the <code>produce</code> method.</p><p>After exposing the Thing, we need to initialize the properties and all required handlers.
This is done by chaining <code>.then</code> method after <code>WoT.produce()</code>.
Property initialization looks as follows.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>.<span style=color:#a6e22e>then</span>( (<span style=color:#a6e22e>thing</span>) =&gt; {
    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;allAvailableResources&#39;</span>, {
        <span style=color:#a6e22e>water</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>readFromSensor</span>(<span style=color:#e6db74>&#39;water&#39;</span>),
        <span style=color:#a6e22e>milk</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>readFromSensor</span>(<span style=color:#e6db74>&#39;milk&#39;</span>),
        <span style=color:#a6e22e>chocolate</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>readFromSensor</span>(<span style=color:#e6db74>&#39;chocolate&#39;</span>),
        <span style=color:#a6e22e>coffeeBeans</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>readFromSensor</span>(<span style=color:#e6db74>&#39;coffeeBeans&#39;</span>),
    });
    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;possibleDrinks&#39;</span>, [<span style=color:#e6db74>&#39;espresso&#39;</span>, <span style=color:#e6db74>&#39;americano&#39;</span>, <span style=color:#e6db74>&#39;cappuccino&#39;</span>, <span style=color:#e6db74>&#39;latte&#39;</span>, <span style=color:#e6db74>&#39;hotChocolate&#39;</span>, <span style=color:#e6db74>&#39;hotWater&#39;</span>]);
    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;maintenanceNeeded&#39;</span>, <span style=color:#66d9ef>false</span>);
    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;schedules&#39;</span>, []);
</code></pre></td></tr></table></div></div><p>In case a property needs a special handler when writing its value, we first need to override its <code>propertyWriteHandler</code>.
See an example below.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#75715e>// Override a write handler for servedCounter property,
</span><span style=color:#75715e></span>    <span style=color:#75715e>// raising maintenanceNeeded flag when the value exceeds 1000 drinks
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>setPropertyWriteHandler</span>(<span style=color:#e6db74>&#39;servedCounter&#39;</span>, (<span style=color:#a6e22e>val</span>) =&gt; {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
            <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>val</span>);
            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>val</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1000</span>) {
                <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;maintenanceNeeded&#39;</span>, <span style=color:#66d9ef>true</span>);
            }
        });
    });
</code></pre></td></tr></table></div></div><p>And then we are ready to initialize its value.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;servedCounter&#39;</span>, <span style=color:#a6e22e>readFromSensor</span>(<span style=color:#e6db74>&#39;servedCounter&#39;</span>));
</code></pre></td></tr></table></div></div><p>We also want to override write and read handlers for <code>availableResourceLevel</code> property, since we need to utilize <code>uriVariables</code>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>setPropertyWriteHandler</span>(<span style=color:#e6db74>&#39;availableResourceLevel&#39;</span>, (<span style=color:#a6e22e>val</span>, <span style=color:#a6e22e>options</span>) =&gt; {

        <span style=color:#75715e>// Check if uriVariables are provided
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>options</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;object&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>&#39;uriVariables&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>options</span>) {
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>uriVariables</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#39;uriVariables&#39;</span>];
            <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>uriVariables</span>) {
                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>readProperty</span>(<span style=color:#e6db74>&#39;allAvailableResources&#39;</span>).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>resources</span>) =&gt; {
                    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>uriVariables</span>[<span style=color:#e6db74>&#39;id&#39;</span>];
                    <span style=color:#a6e22e>resources</span>[<span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>val</span>;
                    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;allAvailableResources&#39;</span>, <span style=color:#a6e22e>resources</span>);
                });
            }
        }
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
            <span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#39;Please specify id variable as uriVariables.&#39;</span>);
        });
    });

    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>setPropertyReadHandler</span>(<span style=color:#e6db74>&#39;availableResourceLevel&#39;</span>, (<span style=color:#a6e22e>options</span>) =&gt; {

        <span style=color:#75715e>// Check if uriVariables are provided
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>options</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;object&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>&#39;uriVariables&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>options</span>) {
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>uriVariables</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#39;uriVariables&#39;</span>];
            <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>uriVariables</span>) {
                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>readProperty</span>(<span style=color:#e6db74>&#39;allAvailableResources&#39;</span>).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>resources</span>) =&gt; {
                    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>uriVariables</span>[<span style=color:#e6db74>&#39;id&#39;</span>];
                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
                        <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>resources</span>[<span style=color:#a6e22e>id</span>]);
                    });
                });
            }
        }
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
            <span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#39;Please specify id variable as uriVariables.&#39;</span>);
        });
    });
</code></pre></td></tr></table></div></div><p>As it has already been mentioned, <code>maintenanceNeeded</code> property is observable, meaning we can get notified when its value changes.
For that, we need to provide a callback for the <code>observeProperty</code> method.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>observeProperty</span>(<span style=color:#e6db74>&#39;maintenanceNeeded&#39;</span>, (<span style=color:#a6e22e>data</span>) =&gt; {
        
        <span style=color:#75715e>// Notify a &#34;maintainer&#34; when the value has changed
</span><span style=color:#75715e></span>        <span style=color:#75715e>// (the notify function here simply logs a message to the console)
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>notify</span>(<span style=color:#e6db74>&#39;admin@coffeeMachine.com&#39;</span>, <span style=color:#e6db74>`maintenanceNeeded property has changed, new value is: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>data</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
    });
</code></pre></td></tr></table></div></div><p>Done with the Property Affordances!
Now we need to set up action handlers, which proceed when another Thing or client invokes the action.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js> <span style=color:#75715e>// Set up a handler for makeDrink action
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>setActionHandler</span>(<span style=color:#e6db74>&#39;makeDrink&#39;</span>, (<span style=color:#a6e22e>params</span>, <span style=color:#a6e22e>options</span>) =&gt; {

        <span style=color:#75715e>// Default values
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>drinkId</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;americano&#39;</span>;
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;m&#39;</span>;
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>quantity</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
        
        <span style=color:#75715e>// Size quantifiers
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sizeQuantifiers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span> <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;s&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.1</span>, <span style=color:#e6db74>&#39;m&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.2</span>, <span style=color:#e6db74>&#39;l&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.3</span>};
        
        <span style=color:#75715e>// Drink recipes showing the amount of a resource consumed for a particular drink
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>drinkRecipes</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span> <span style=color:#f92672>=</span> {
            <span style=color:#e6db74>&#39;espresso&#39;</span><span style=color:#f92672>:</span> { ... },
            <span style=color:#e6db74>&#39;americano&#39;</span><span style=color:#f92672>:</span> { ... },
            <span style=color:#e6db74>&#39;cappuccino&#39;</span><span style=color:#f92672>:</span> { ... },
            <span style=color:#e6db74>&#39;latte&#39;</span><span style=color:#f92672>:</span> { ... },
            <span style=color:#e6db74>&#39;hotChocolate&#39;</span><span style=color:#f92672>:</span> { ... },
            <span style=color:#e6db74>&#39;hotWater&#39;</span><span style=color:#f92672>:</span> { ... },
        }

        <span style=color:#75715e>// Check if uriVariables are provided
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>options</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;object&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>&#39;uriVariables&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>options</span>) {
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>uriVariables</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#39;uriVariables&#39;</span>];
            <span style=color:#a6e22e>drinkId</span> <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;drinkId&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>uriVariables</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>uriVariables</span>[<span style=color:#e6db74>&#39;drinkId&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#a6e22e>drinkId</span>;
            <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;size&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>uriVariables</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>uriVariables</span>[<span style=color:#e6db74>&#39;size&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#a6e22e>size</span>;
            <span style=color:#a6e22e>quantity</span> <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;quantity&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>uriVariables</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>uriVariables</span>[<span style=color:#e6db74>&#39;quantity&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#a6e22e>quantity</span>;
        }

        <span style=color:#75715e>// Read the current level of allAvailableResources
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>readProperty</span>(<span style=color:#e6db74>&#39;allAvailableResources&#39;</span>).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>resources</span>) =&gt; {
            
            <span style=color:#75715e>// Calculate the new level of resources
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newResources</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>assign</span>({}, <span style=color:#a6e22e>resources</span>);
            <span style=color:#a6e22e>newResources</span>[<span style=color:#e6db74>&#39;water&#39;</span>] <span style=color:#f92672>-=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#a6e22e>quantity</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>sizeQuantifiers</span>[<span style=color:#a6e22e>size</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>drinkRecipes</span>[<span style=color:#a6e22e>drinkId</span>][<span style=color:#e6db74>&#39;water&#39;</span>]);
            <span style=color:#a6e22e>newResources</span>[<span style=color:#e6db74>&#39;milk&#39;</span>] <span style=color:#f92672>-=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#a6e22e>quantity</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>sizeQuantifiers</span>[<span style=color:#a6e22e>size</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>drinkRecipes</span>[<span style=color:#a6e22e>drinkId</span>][<span style=color:#e6db74>&#39;milk&#39;</span>]);
            <span style=color:#a6e22e>newResources</span>[<span style=color:#e6db74>&#39;chocolate&#39;</span>] <span style=color:#f92672>-=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#a6e22e>quantity</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>sizeQuantifiers</span>[<span style=color:#a6e22e>size</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>drinkRecipes</span>[<span style=color:#a6e22e>drinkId</span>][<span style=color:#e6db74>&#39;chocolate&#39;</span>]);
            <span style=color:#a6e22e>newResources</span>[<span style=color:#e6db74>&#39;coffeeBeans&#39;</span>] <span style=color:#f92672>-=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#a6e22e>quantity</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>sizeQuantifiers</span>[<span style=color:#a6e22e>size</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>drinkRecipes</span>[<span style=color:#a6e22e>drinkId</span>][<span style=color:#e6db74>&#39;coffeeBeans&#39;</span>]);

            <span style=color:#75715e>// Check if the amount of available resources is sufficient to make a drink
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>resource</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>newResources</span>) {
                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>newResources</span>[<span style=color:#a6e22e>resource</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>) {
                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
                        <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>emitEvent</span>(<span style=color:#e6db74>&#39;outOfResource&#39;</span>, <span style=color:#e6db74>`Low level of </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>resource</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>resources</span>[<span style=color:#a6e22e>resource</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>%`</span>);
                        <span style=color:#a6e22e>resolve</span>({<span style=color:#a6e22e>result</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>resource</span><span style=color:#e6db74>}</span><span style=color:#e6db74> level is not sufficient`</span>});
                    });
                }
            }

            <span style=color:#75715e>// Now store the new level of allAvailableResources
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;allAvailableResources&#39;</span>, <span style=color:#a6e22e>newResources</span>).<span style=color:#a6e22e>then</span>(() =&gt; {
                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>readProperty</span>(<span style=color:#e6db74>&#39;servedCounter&#39;</span>).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>counter</span>) =&gt; {
                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
                        <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;servedCounter&#39;</span>, <span style=color:#a6e22e>counter</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>quantity</span>);

                        <span style=color:#75715e>// Finally deliver the drink
</span><span style=color:#75715e></span>                        <span style=color:#a6e22e>resolve</span>({<span style=color:#a6e22e>result</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Your </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>drinkId</span><span style=color:#e6db74>}</span><span style=color:#e6db74> is in progress!`</span>});
                    });
                });
            });
        });
    });
</code></pre></td></tr></table></div></div><p>Notice, how in case of insufficient resources the <code>outOfResource</code> event is emitted.
Note also that <code>uriVariables</code> is being passed into options variable as a second argument of the handler.
The first argument <code>params</code> contains a request body (i.e. payload of a request).</p><p>Another handler is for <code>setSchedule</code> action.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#75715e>// Set up a handler for setSchedule action
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>setActionHandler</span>(<span style=color:#e6db74>&#39;setSchedule&#39;</span>, (<span style=color:#a6e22e>params</span>, <span style=color:#a6e22e>options</span>) =&gt; {

        <span style=color:#75715e>// Check if uriVariables are provided
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;object&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>&#39;time&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>&#39;mode&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>params</span>) {

            <span style=color:#75715e>// Use default values if not provided
</span><span style=color:#75715e></span>            <span style=color:#a6e22e>params</span>[<span style=color:#e6db74>&#39;drinkId&#39;</span>] <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;drinkId&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>params</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>params</span>[<span style=color:#e6db74>&#39;drinkId&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;americano&#39;</span>;
            <span style=color:#a6e22e>params</span>[<span style=color:#e6db74>&#39;size&#39;</span>] <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;size&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>params</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>params</span>[<span style=color:#e6db74>&#39;size&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;m&#39;</span>;
            <span style=color:#a6e22e>params</span>[<span style=color:#e6db74>&#39;quantity&#39;</span>] <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;quantity&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>params</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>params</span>[<span style=color:#e6db74>&#39;quantity&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;

            <span style=color:#75715e>// Now read the schedules property, add a new schedule to it and then rewrite the schedules property
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>readProperty</span>(<span style=color:#e6db74>&#39;schedules&#39;</span>).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>schedules</span>) =&gt; {
                <span style=color:#a6e22e>schedules</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>params</span>);
                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;schedules&#39;</span>, <span style=color:#a6e22e>schedules</span>).<span style=color:#a6e22e>then</span>(() =&gt; {
                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
                        <span style=color:#a6e22e>resolve</span>({<span style=color:#a6e22e>result</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Your schedule has been set!`</span>});
                    });
                });
            });

        }
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
            <span style=color:#a6e22e>resolve</span>({<span style=color:#a6e22e>result</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Please provide all the required parameters: time and mode.`</span>});
        });
    });
</code></pre></td></tr></table></div></div><p>As mentioned above, here we use the payload of a request, therefore we utilize the <code>params</code> variable.</p><p>Done with the Action Affordances!
Now our final affordances, that is Event Affordances.
We can specify a handler for an event, which then gets executed whenever the event is emitted.
In node-wot this process is called &ldquo;subscribing&rdquo; for an event.
Although it is possible to create event handlers in the producer Thing, usually it is done on the client side.
So, the producer (server) only emits a particular event and the client is responsible for handling it.
Below in the <a href=#consume-the-thing>client part</a> we will cover this process.</p><p>Now, finally, expose the Thing!</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#75715e>// Expose the Thing and log a message to the console
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>expose</span>().<span style=color:#a6e22e>then</span>( () =&gt; { <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>getThingDescription</span>().<span style=color:#a6e22e>title</span><span style=color:#e6db74>}</span><span style=color:#e6db74> ready`</span>); } ); 
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Produced </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>getThingDescription</span>().<span style=color:#a6e22e>title</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</code></pre></td></tr></table></div></div><h2 id=consume-the-thing>Consume the Thing</h2><p>So far we are done with the &ldquo;producer&rdquo; Thing and now our smart coffee machine can be interacted via any HTTP or CoAP client (default protocol bindings as mentioned above).
The produced Thing Description is available at http://127.0.0.1:8080/smart-coffee-machine for HTTP and coap://127.0.0.1:5683/smart-coffee-machine for CoAP.
By default, in HTTP binding the GET method is used for reading properties, PUT for writing and POST for invoking actions.
So, for example the value of <code>allAvailableResources</code> property can be read as:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=color:#a6e22e>GET</span> /smart-coffee-machine/properties/allAvailableResources <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>127.0.0.1:8080</span></code></pre></td></tr></table></div></div><p>The value of <code>availableResourceLevel</code> property can be set as:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=color:#a6e22e>PUT</span> /smart-coffee-machine/properties/availableResourceLevel?id=water <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>127.0.0.1:8080</span>
Content-Type<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/json</span></code></pre></td></tr></table></div></div><p>And <code>makeDrink</code> and <code>setSchedule</code> actions can be invoked as:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=color:#a6e22e>POST</span> /smart-coffee-machine/actions/makeDrink?drinkId=hotChocolate&amp;size=s&amp;quantity=5 <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>127.0.0.1:8080</span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=color:#a6e22e>POST</span> /smart-coffee-machine/actions/setSchedule <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>127.0.0.1:8080</span>
Content-Type<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/json</span>

{
	<span style=color:#f92672>&#34;drinkId&#34;</span>: <span style=color:#e6db74>&#34;latte&#34;</span>,
	<span style=color:#f92672>&#34;size&#34;</span>: <span style=color:#e6db74>&#34;m&#34;</span>,
	<span style=color:#f92672>&#34;quantity&#34;</span>: <span style=color:#ae81ff>2</span>,
	<span style=color:#f92672>&#34;time&#34;</span>: <span style=color:#e6db74>&#34;10:15&#34;</span>,
	<span style=color:#f92672>&#34;mode&#34;</span>: <span style=color:#e6db74>&#34;everyday&#34;</span>
}</code></pre></td></tr></table></div></div><p>As we already mentioned, note that one uses query string and the other one uses a payload.</p><p>We can also create a consumer Thing (i.e. a client) for our smart coffee machine using the node-wot API.
In order to create a consumer Thing, we need to invoke <code>fetch</code> method of the WoTHelpers object giving it an exposed Thing Description as the only parameter, and then invoke <code>consume</code> method of the WoT object as follows.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// We could also use CoAP here
</span><span style=color:#75715e></span><span style=color:#a6e22e>WoTHelpers</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;http://127.0.0.1:8080/smart-coffee-machine&#34;</span>).<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>td</span>) =&gt; {

    <span style=color:#66d9ef>try</span> {
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>thing</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WoT</span>.<span style=color:#a6e22e>consume</span>(<span style=color:#a6e22e>td</span>);
        <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Thing Description:&#39;</span>, <span style=color:#a6e22e>td</span>);

    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>err</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Script error:&#39;</span>, <span style=color:#a6e22e>err</span>);
    }

});
</code></pre></td></tr></table></div></div><p>The full &ldquo;client&rdquo; script is available at <a href=https://github.com/eclipse/thingweb.node-wot/blob/master/packages/examples/src/scripts/smart-coffee-machine-client.ts>node-wot GitHub repository</a>.
Notice that, we are awaiting asynchronous functions to complete before proceeding, which is quite logical here.
Remember that we need the <code>async</code> keyword in the outer function in order to use <code>await</code> inside the function.
We could also chain the asynchronous <code>consume</code> method with other methods using <code>.then</code>.
But let&rsquo;s stick with <code>async/await</code> for our example.
A property can be read using <code>thing.readProperty</code> method.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>        <span style=color:#75715e>// Read property allAvailableResources
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>allAvailableResources</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>readProperty</span>(<span style=color:#e6db74>&#39;allAvailableResources&#39;</span>);
        <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;allAvailableResources value is:&#39;</span>, <span style=color:#a6e22e>allAvailableResources</span>);
});
</code></pre></td></tr></table></div></div><p>A property can be written using <code>thing.writeProperty</code> method.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>        <span style=color:#75715e>// Now let&#39;s change water level to 80
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>writeProperty</span>(<span style=color:#e6db74>&#39;availableResourceLevel&#39;</span>, <span style=color:#ae81ff>80</span>, {<span style=color:#e6db74>&#39;uriVariables&#39;</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#39;id&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;water&#39;</span>}});
});
</code></pre></td></tr></table></div></div><p>Notice on usage of <code>uriVariables</code> here.
In the same manner they can be used when reading properties which utilize <code>uriVariables</code>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>        <span style=color:#75715e>// And see that the water level has changed
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>waterLevel</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>readProperty</span>(<span style=color:#e6db74>&#39;availableResourceLevel&#39;</span>, {<span style=color:#e6db74>&#39;uriVariables&#39;</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#39;id&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;water&#39;</span>}});
        <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;waterLevel value after change is:&#39;</span>, <span style=color:#a6e22e>waterLevel</span>);
});
</code></pre></td></tr></table></div></div><p>It&rsquo;s also possible to set a client-side handler for observable properties.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>        <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>observeProperty</span>(<span style=color:#e6db74>&#39;maintenanceNeeded&#39;</span>, (<span style=color:#a6e22e>data</span>) =&gt; {
            <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;maintenanceNeeded property has changed! New value is:&#39;</span>, <span style=color:#a6e22e>data</span>);
        });
});
</code></pre></td></tr></table></div></div><p>Notice that, here we don&rsquo;t need to await for a function to complete, since observing a property is a persistent action.</p><p>We can invoke an action using <code>thing.invokeAction</code> method.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>        <span style=color:#75715e>// Now let&#39;s make 3 cups of latte!
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>makeCoffee</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>invokeAction</span>(<span style=color:#e6db74>&#39;makeDrink&#39;</span>, <span style=color:#66d9ef>undefined</span>, {<span style=color:#e6db74>&#39;uriVariables&#39;</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#39;drinkId&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;latte&#39;</span>, <span style=color:#e6db74>&#39;size&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;l&#39;</span>, <span style=color:#e6db74>&#39;quantity&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>}});
        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>makeCoffee</span>[<span style=color:#e6db74>&#39;result&#39;</span>]) {
            <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Enjoy your drink!&#39;</span>, <span style=color:#a6e22e>makeCoffee</span>);
        } <span style=color:#66d9ef>else</span> {
            <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Failed making your drink:&#39;</span>, <span style=color:#a6e22e>makeCoffee</span>);
        } 
</code></pre></td></tr></table></div></div><p>Notice on usage of <code>uriVariables</code> here.
They are passed as a third argument, whereas the second one is the payload of a request.
This can be well noted on invoking of <code>setSchedule</code> action.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>        <span style=color:#75715e>// Let&#39;s add a scheduled task
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>scheduledTask</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>invokeAction</span>(<span style=color:#e6db74>&#39;setSchedule&#39;</span>, {
            <span style=color:#e6db74>&#39;drinkId&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;espresso&#39;</span>,
            <span style=color:#e6db74>&#39;size&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;m&#39;</span>,
            <span style=color:#e6db74>&#39;quantity&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
            <span style=color:#e6db74>&#39;time&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;10:00&#39;</span>,
            <span style=color:#e6db74>&#39;mode&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;everyday&#39;</span>
        });
        <span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>scheduledTask</span>[<span style=color:#e6db74>&#39;message&#39;</span>], <span style=color:#a6e22e>scheduledTask</span>);
</code></pre></td></tr></table></div></div><p>As it is already mentioned above, we also want a client to subscribe for events emitted from the producer Thing.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>        <span style=color:#75715e>// Let&#39;s set up a handler for outOfResource event
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>thing</span>.<span style=color:#a6e22e>subscribeEvent</span>(<span style=color:#e6db74>&#39;outOfResource&#39;</span>, (<span style=color:#a6e22e>data</span>) =&gt; {
            <span style=color:#75715e>// Here we are simply logging the message when the event is emitted
</span><span style=color:#75715e></span>            <span style=color:#75715e>// But, of course, could have a much more sophisticated handler
</span><span style=color:#75715e></span>            <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;outOfResource event:&#39;</span>, <span style=color:#a6e22e>data</span>);
        });
</code></pre></td></tr></table></div></div><p>Again, here we don&rsquo;t need to await for a function to complete, since subscribing for an event is a persistent action.</p><h2 id=running-scripts-from-node-wot-repository>Running scripts from node-wot repository</h2><p>As it is mentioned above, these example scripts are available at <a href=https://github.com/eclipse/thingweb.node-wot/blob/master/packages/examples/src/scripts>node-wot GitHub repository</a>.
In order to run them do the following:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 1. Clone the repo</span>
git clone https://github.com/eclipse/thingweb.node-wot
<span style=color:#75715e># 2. cd to the project&#39;s root directory</span>
cd thingweb.node-wot
<span style=color:#75715e># 3. Install dependencies </span>
npm install
<span style=color:#75715e># 4. Build the project</span>
npm run build</code></pre></td></tr></table></div></div><p>Now you can run the scripts as follows:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 1. Run the producer Thing (&#34;server&#34;)</span>
node packages/cli/dist/cli.js examples/scripts/smart-coffee-machine.js
<span style=color:#75715e># 2. Run the consumer Thing (&#34;client&#34;)</span>
node packages/cli/dist/cli.js examples/scripts/smart-coffee-machine-client.js --clientonly</code></pre></td></tr></table></div></div><p>If you want to add your own example scripts be sure to follow the <a href=https://github.com/eclipse/thingweb.node-wot/tree/master/packages/examples#workflow>workflow</a>.</p><p>In case you want to just consume a Thing you can use a tool like the <a href=http://plugfest.thingweb.io/webui/>Browsified node-wot</a>.
It allows you to interact with Things right from your browser.
There is a deployed smart coffee machine producer Thing at <a href=http://plugfest.thingweb.io:8083/smart-coffee-machine>http://plugfest.thingweb.io:8083/smart-coffee-machine</a> that you can consume.
You can also see its property values in real-time at <a href=http://plugfest.thingweb.io/examples/smart-coffee-machine.html>http://plugfest.thingweb.io/examples/smart-coffee-machine.html</a>.</p><h2 id=smart-coffee-machine-and-oauth-20>Smart coffee machine and oAuth 2.0</h2><p>Currently, node-wot supports different security schemas.
In the example above we have used the <a href=https://www.w3.org/TR/wot-thing-description/#sec-security-vocabulary-definition><code>NoSecurityScheme</code></a>, as it is assumed by default if no security scheme is explicitly used.
Node-wot also supports oAuth 2.0, so let&rsquo;s extend this tutorial with the same coffee machine having oAuth 2.0 authorization.</p><p>Extend the Thing Description within the <code>produce</code> method with the following lines (add <code>id</code>, <code>securityDefinitions</code> and <code>security</code>):</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> ...
    <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;urn:dev:wot:example:smart-coffee-machine&#39;</span>,
    ...
    <span style=color:#a6e22e>securityDefinitions</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>oauth2_sc</span><span style=color:#f92672>:</span> {
            <span style=color:#a6e22e>scheme</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;oauth2&#39;</span>,
            <span style=color:#a6e22e>flow</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;client_credentials&#39;</span>,
            <span style=color:#a6e22e>token</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://127.0.0.1:3000/token&#39;</span>,
            <span style=color:#a6e22e>scopes</span><span style=color:#f92672>:</span> [
                <span style=color:#e6db74>&#39;limited&#39;</span>,
            ],
        },
    },
    <span style=color:#a6e22e>security</span><span style=color:#f92672>:</span> [
        <span style=color:#e6db74>&#39;oauth2_sc&#39;</span>,
    ],
    <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
        ...
</code></pre></td></tr></table></div></div><p>The full script is available at node-wot GitHub repository as <a href=https://github.com/eclipse/thingweb.node-wot/blob/master/packages/examples/src/scripts/smart-coffee-machine-oauth.ts>smart-coffee-machine-oauth.ts</a>.</p><p>Now if we run the producer and the consumer Things as before that will fail.
The reason is simple - the client is not authorized.
Let&rsquo;s fix it.</p><p>We need an additional configuration file which will contain the appropriate credentials.
The configuration file contains the following and is available as <a href=https://github.com/eclipse/thingweb.node-wot/tree/master/examples/scripts/smart-coffee-machine-client.conf.json>smart-coffee-machine-client.conf.json</a>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>{
    <span style=color:#e6db74>&#34;http&#34;</span><span style=color:#f92672>:</span> {
        <span style=color:#e6db74>&#34;allowSelfSigned&#34;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
    },
    <span style=color:#e6db74>&#34;credentials&#34;</span><span style=color:#f92672>:</span> {
        <span style=color:#e6db74>&#34;urn:dev:wot:example:smart-coffee-machine&#34;</span><span style=color:#f92672>:</span> {
            <span style=color:#e6db74>&#34;clientId&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;node-wot&#34;</span>,
            <span style=color:#e6db74>&#34;clientSecret&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;isgreat!&#34;</span>
        }
    }
}
</code></pre></td></tr></table></div></div><p>The first setting allows self-signed certificates, which is okay for testing and development purposes.
The other setting provides the credentials in a form of &ldquo;Thing id - credentials&rdquo; pair.
We will be using the oAuth 2.0 test server which is equipped with node-wot, and it expects exactly these <code>clientId</code> and <code>clientSecret</code>.</p><p>Now run the test oAuth server:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 1. From the project&#39;s root directory run</span>
cd packages/examples/src/security/oauth
<span style=color:#75715e># 2. Run the oAuth 2.0 test server</span>
npm run server</code></pre></td></tr></table></div></div><p>You should see a message saying <code>listening</code>.
Now in a different terminal run the coffee machine producer Thing as usual:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 1. From the project&#39;s root directory</span>
node packages/cli/dist/cli.js examples/scripts/smart-coffee-machine-oauth.js</code></pre></td></tr></table></div></div><p>Finally, from the third terminal run the coffee machine consumer Thing providing it with the configuration file we have created:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 1. From the project&#39;s root directory</span>
node packages/cli/dist/cli.js -f examples/scripts/smart-coffee-machine-client.conf.json examples/scripts/smart-coffee-machine-client.js --clientonly</code></pre></td></tr></table></div></div><p>Now the client interacts with the smart coffee machine as before since it is authorized by the oAuth server.</p></div></div></div></div></div></div></div><div class=container><div><div class=footer-shape><img src=./img/others/footer-shape.jpg class=img-fluid width=100%></div><footer><div class="foot-link text-center"><ul class=list-inline><li><a href=./>Home</a></li><li>|</li><li><a href=https://github.com/eclipse/thingweb.node-wot/>Project on Github</a></li><li>|</li><li><a href=./get-involved.html>Contact us</a></li></ul></div><div class="copy text-center"><p>Copyrights &copy; 2022 Thingweb. All Rights Reserved. <span>|</span> <a href=http://www.eclipse.org/legal/termsofuse.php>Terms of Use</a> <span>|</span> <a href=http://www.eclipse.org/legal/privacy.php>Privacy Policy</a></p></div></footer><script type=text/javascript src=./js/jquery-1.11.3.min.js language=javascript></script><script type=text/javascript src=./js/bootstrap.min.js language=javascript></script><script type=text/javascript src=./js/custom.js language=javascript></script><script type=text/javascript src=./js/owl.carousel.js></script></div></div></body></html>